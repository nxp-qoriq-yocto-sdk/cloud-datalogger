# Compiler check
ifeq ($(CROSS_COMPILE),)
$(warning CROSS_COMPILE is not set!)
endif

CC := $(CROSS_COMPILE)gcc
RM := rm -f
MKDIR := mkdir -p

CFLAGS := -O0 -Wall -g

SQLITE3_PATH = /home/user/b37786/dn-auto-ask/src-openwrt-ls1043a_7.0.1.B1-DCM/build_dir/target-aarch64_armv8-a_glibc-2.19/root-ls1043a/usr/lib
AWS_IOT_DIR = ../../../../aws_iot-c-sdk-aarch64-compiled
BUILD_DIR = ./
OBJ_DIR = $(BUILD_DIR)/obj
ELF = $(BUILD_DIR)/aws-cloudlogger
INCLUDES += -I $(AWS_IOT_DIR)/include
INCLUDES += -I $(AWS_IOT_DIR)/platform/linux/common
INCLUDES += -I $(AWS_IOT_DIR)/platform/linux/mbedtls
INCLUDES += -I $(AWS_IOT_DIR)/external_libs/mbedTLS/include
INCLUDES += -I /home/user/b37786/dn-auto-ask/src-openwrt-ls1043a_7.0.1.B1-DCM/build_dir/target-aarch64_armv8-a_glibc-2.19/sqlite-autoconf-3081101

MBEDTLS_DIR = $(AWS_IOT_DIR)/external_libs/mbedTLS
TLS_LIB_DIR = $(MBEDTLS_DIR)/library
LIBS += -Wl,-rpath,$(TLS_LIB_DIR)
LIBS += $(AWS_IOT_DIR)/samples/linux/subscribe_publish_library_sample/libAwsIotSdk.a -ldl $(TLS_LIB_DIR)/libmbedtls.a $(TLS_LIB_DIR)/libmbedcrypto.a $(TLS_LIB_DIR)/libmbedx509.a -lpthread -L$(SQLITE3_PATH) -lsqlite3

# create object file list
OBJS = \
	$(OBJ_DIR)/datalogger.o \
	$(OBJ_DIR)/jWrite.o

$(OBJ_DIR)/%.o: src/%.c
	@echo 'Building app file: $<'
	$(CC) $(INCLUDES) $(CFLAGS) -c -o $@ $<
	@echo 'Finished building: $<'
	@echo ' '

# All Target
all: $(ELF)

# Executable target
$(ELF): $(OBJS)
	@echo 'Building target: $@'
	$(CC) -o $(ELF) $(OBJS) $(LIBS)
	@echo 'Finished building target: $@'
	@echo ' '

# Other Targets
clean:
	-$(RM) $(OBJS) $(ELF)
	-@echo ' '

.PHONY: all clean
